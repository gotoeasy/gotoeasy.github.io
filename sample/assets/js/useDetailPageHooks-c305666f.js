var T=Object.defineProperty;var S=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var V=(s,l,e)=>l in s?T(s,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[l]=e,b=(s,l)=>{for(var e in l||(l={}))j.call(l,e)&&V(s,e,l[e]);if(S)for(var e of S(l))q.call(l,e)&&V(s,e,l[e]);return s};var p=(s,l,e)=>new Promise((a,d)=>{var g=n=>{try{t(e.next(n))}catch(o){d(o)}},$=n=>{try{t(e.throw(n))}catch(o){d(o)}},t=n=>n.done?a(n.value):Promise.resolve(n.value).then(g,$);t((e=e.apply(s,l)).next())});import{r as i,$ as z,V as w}from"./index-332affe8.js";const G=(s={})=>{const{detail:l,pageTitle:e,mitt:a,urlAdd:d,urlEdit:g,viewCallback:$,editCallback:t,createCallback:n,beforeSave:o}=s,C=i(""),c=i(!1),v=i(!1),f=i({}),r=i(!1),k=l||"detail";a==null||a.on(`${k}:create`,()=>{h()}),a==null||a.on(`${k}:edit`,u=>{y(u)}),a==null||a.on(`${k}:view`,u=>{D(u)});const m=(u,A)=>p(void 0,null,function*(){yield u.validate(H=>{if(!H)return;const M=v.value?d:g,E=b({},A||f.value);o&&o(E),z(M,E).then(P=>{if(!P.success)return w.error(P.message);w.info("操作成功！"),r.value=!1,a==null||a.emit("main:search")})})}),x=()=>p(void 0,null,function*(){(c.value||(yield w.confirm("确定放弃修改吗？")))&&(r.value=!1,a==null||a.emit("main:show",!0))}),h=()=>{C.value=`新建${e}`,f.value={},c.value=!1,v.value=!0,r.value=!0,n&&n()},y=u=>{C.value=`编辑${e}`,f.value=b({},u),c.value=!1,v.value=!1,r.value=!0,t&&t(u)},D=u=>{C.value=`查看${e}`,f.value=b({},u),c.value=!0,v.value=!1,r.value=!0,$&&$(u)};return{title:C,readonly:c,isCreateMode:v,formData:f,visible:r,fnClose:x,fnSave:m,fnCreate:h,fnEdit:y,fnView:D}};export{G as u};
