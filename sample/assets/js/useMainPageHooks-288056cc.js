var V=Object.defineProperty,W=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var H=(n,e,a)=>e in n?V(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,x=(n,e)=>{for(var a in e||(e={}))L.call(e,a)&&H(n,a,e[a]);if(T)for(var a of T(e))O.call(e,a)&&H(n,a,e[a]);return n},$=(n,e)=>W(n,F(e));var C=(n,e,a)=>new Promise((S,u)=>{var v=o=>{try{l(a.next(o))}catch(f){u(f)}},w=o=>{try{l(a.throw(o))}catch(f){u(f)}},l=o=>o.done?S(o.value):Promise.resolve(o.value).then(v,w);l((a=a.apply(n,e)).next())});import{r as p,ae as k,Q,$ as D,V as m,au as B,av as j}from"./index-332affe8.js";let s=null,i=null;function y(n,e){s=s||B(),i=i||j();const a=s.pageMaximize||s.tabsMaximize?0:i.headerHeight,S=!s.pageMaximize&&i.showPageTabs?i.pageTabsHeight+1:0,u=!s.tabsMaximize&&!s.pageMaximize&&i.showFooter?i.mainPanelMarginTop+i.footerHeight:i.mainPanelMarginTop+i.mainPanelMarginBottom,v=i.mainPanelPaddingTop+i.mainPanelPaddingBottom,w=e?0:32,l=n?0:42+2,o=8+32+8;return`calc(100vh - ${a+S+u+v+w+l+o}px)`}const ee=n=>{const{mitt:e,pageSettingStore:a,defaultSearchCondition:S,searchCallback:u,withoutSearchForm:v,withoutPagging:w}=n,{pageOptions:l}=a;let o=p(null);const f=p(x({},S||{})),z=p([]),N=k(()=>y(v,w)),h=Q({pageNo:1,pageSize:a.pageSize||10,pageSizes:a.pageSizes||[10,20,30,50],total:0}),b=p(!1),P=p(!1),R=k(()=>P.value?o.value.getSelectionRows().length:0),r=p(!0),E=t=>{o=t,P.value=!0,d(1)};e==null||e.on("main:mounted",t=>{o=t,P.value=!0,d(1)}),e==null||e.on("main:show",t=>{r.value=!!t}),e==null||e.on("main:search",()=>{r.value=!0,d()});const d=t=>{b.value=!0,h.pageNo=t||h.pageNo;const c=$(x({},f.value),{pageNo:h.pageNo,pageSize:h.pageSize});D(l.urlSearch,c).then(g=>{g.success?(g.data.records?(z.value=g.data.records,h.total=g.data.total):z.value=g.data,u&&u()):m.error(g.message)}).finally(()=>{b.value=!1})};return{visible:r,onMountedCallback:E,formData:f,tableData:z,getTableHeight:y,tableHeight:N,pageSettingStore:a,pagging:h,showTableLoadding:b,fnSearch:d,fnDeleteRow:(t,c)=>C(void 0,null,function*(){const g=t[c]?`确定删除${l.pageTitle}（${t[c]}）？`:"确定删除？";(yield m.confirm(g))&&D(l.urlDelete,{id:t.id}).then(M=>{M.success?(d(),m.info("操作成功！")):m.error(M.message)})}),onPaggingChange:()=>{a.pageSize=h.pageSize,d()},fnChangeColumnWidth:(t,c,g)=>{for(const M of a.header)if(M.key===g.property){M.width=t;break}},hasSelect:R,fnCreate:()=>{!a.drawerDetailMode&&(r.value=!1),e==null||e.emit("detail:create")},fnEdit:t=>{!a.drawerDetailMode&&(r.value=!1),e==null||e.emit("detail:edit",t)},fnView:t=>{!a.drawerDetailMode&&(r.value=!1),e==null||e.emit("detail:view",t)},fnShow:t=>{t?r.value=!0:r.value=!1},fnDeleteBatch:()=>C(void 0,null,function*(){if(yield m.confirm("确定删除全部勾选数据？")){const t=[];o.value.getSelectionRows().forEach(c=>t.push(c.id)),D(l.urlDeleteBatch,t).then(c=>{c.success?(d(),m.info("操作成功！")):m.error(c.message)})}}),fnSwitchMaximizePage:()=>{s=s||B(),s.pageMaximize=!s.pageMaximize}}};export{ee as u};
